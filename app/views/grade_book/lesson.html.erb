<div class="col-xl-12 col-md-12 col-sm-12 col-xs-12 home-page-card-opacity">
  <div class="jumbotron">
    <div class="col-xl-12 col-md-12 col-xs-12">
      <div>
        <h1>Lesson View</h1>
        <table class="table table-bordered">
          <thead>
          <tr>
            <th>Student Name</th>
            <!-- TODO: This needs to be on a different page or passed in a specific lesson-->
            <% @lesson.lesson_modules.each do |lesson_module| %>
                <th colspan="2"><%= link_to lesson_module.name, course_gradebook_lesson_module_path(lesson_module_id: lesson_module.id) %></th>
            <% end %>
            <th colspan="2">Total</th>
          </tr>

          <tr>
            <th></th>
            <% (0...@lesson.lesson_modules.length).each do %>
                <th>Grade</th>
                <th>Time</th>
            <% end %>
            <th>Grade</th>
            <th>Time</th>
          </tr>

          <tr>
            <th>Averages</th>
            <% @lesson.lesson_modules.each do |lesson_module| %>
                <% lesson_module_grade_total, lesson_module_time_total = @answers["Lesson Module #{lesson_module.id}"] %>
                <th><%= lesson_module_grade_total %>%</th>
                <th><%= lesson_module_time_total %> sec</th>
            <% end %>
            <% final_students_grade, final_students_time = @answers["Lesson #{@lesson.id}"] %>
            <th><%= final_students_grade %>%</th>
            <th><%= final_students_time %> sec</th>
          </tr>
          </thead>

          <tbody>
          <% @users.each do |user| %>
              <tr>
                <td><%= link_to user.name, course_gradebook_student_path(student_id: user.id) %></td>
                <% @lesson.lesson_modules.each do |lesson_module| %>
                    <% grade, time = get_grades_lesson(@answers, lesson_module, user) %>
                    <th><%= grade %>%</th>
                    <th><%= time %> sec</th>
                <% end %>
                <% final_grade, final_time = @answers["#{user.id}"] %>
                <th><%= final_grade %>%</th>
                <th><%= final_time %></th>
              </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
    <div class="clearfix"></div>
  </div>
</div>